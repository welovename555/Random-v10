<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ตัวช่วยจัดรูปแบบข้อความ (4–5 แบบ)</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --muted:#9fb0d0;
      --text:#e9efff;
      --line:#243059;
      --btn:#2b63ff;
      --btn2:#1c2b54;
      --ok:#26d07c;
      --warn:#ffcc66;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans Thai", sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, #14224a 0%, transparent 55%),
                  radial-gradient(900px 500px at 80% 0%, #1b2a63 0%, transparent 50%),
                  var(--bg);
      color:var(--text);
      line-height:1.45;
    }
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px 32px}
    h1{font-size:20px;margin:0 0 8px}
    .sub{color:var(--muted);margin:0 0 18px;font-size:13px}

    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:14px;align-items:start}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    textarea{
      width:100%;
      min-height:220px;
      resize:vertical;
      border-radius:14px;
      padding:12px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
    }
    textarea:focus{border-color:rgba(43,99,255,.7);box-shadow:0 0 0 3px rgba(43,99,255,.18)}

    .ctl{display:flex;align-items:center;gap:10px;padding:10px 10px;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:rgba(0,0,0,.16)}
    .ctl label{font-size:13px;color:var(--text)}
    .ctl small{display:block;color:var(--muted);font-size:12px;margin-top:2px}
    .ctl input[type="checkbox"]{width:18px;height:18px;accent-color:var(--btn)}

    select, input[type="number"]{
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 10px;
      outline:none;
    }

    button{
      border:0;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      color:var(--text);
      background: var(--btn2);
      border:1px solid rgba(255,255,255,.10);
    }
    button.primary{background: linear-gradient(180deg, #2b63ff, #1b4de6); border-color:rgba(255,255,255,.15)}
    button:hover{filter:brightness(1.05)}
    button:active{transform: translateY(1px)}

    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.15);color:var(--muted);font-size:12px}

    .outGrid{display:grid;grid-template-columns:1fr;gap:10px}
    .outCard{border:1px solid rgba(255,255,255,.10);border-radius:14px;background:rgba(0,0,0,.18);padding:10px}
    .outHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
    .outHead b{font-size:13px}
    .outHead .actions{display:flex;gap:8px;flex-wrap:wrap}
    .out{white-space:pre-wrap;word-break:break-word;background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px;font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:13px}

    .note{color:var(--muted);font-size:12px;margin-top:10px}
    .status{margin-left:auto;font-size:12px;color:var(--muted)}
    .ok{color:var(--ok)}
    .warn{color:var(--warn)}

    .footer{margin-top:12px;color:var(--muted);font-size:12px}
    a{color:#9fc1ff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ตัวช่วยจัดรูปแบบข้อความ (สร้าง 4–5 แบบ)</h1>
    <p class="sub">เครื่องมือนี้ออกแบบเพื่อ <b>จัดรูปแบบ / ทำให้ไม่ซ้ำกัน</b> โดยยังอ่านง่ายและคงข้อมูลสำคัญครบถ้วน (เช่น เบอร์โทร/เลขที่/รหัสไปรษณีย์)</p>

    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between; margin-bottom:10px">
          <span class="pill">อินพุตข้อความหลายบรรทัด</span>
          <span id="phoneStatus" class="status"></span>
        </div>
        <textarea id="input" placeholder="วางข้อความที่นี่ (ชื่อ/ที่อยู่/เบอร์โทร ฯลฯ)\n\nตัวอย่าง:\nที่อยู่ 14/12 อเมซอนเขาตะเกียบ ต.หนองแก อ.หัวหิน จ.ประจวบคีรีขันธ์ 77110 ค่า\n0658069021"></textarea>

        <div class="row" style="margin-top:12px">
          <button class="primary" id="btnGen">แปลงข้อความ</button>
          <button id="btnClear">ล้าง</button>
          <span class="status" id="genStatus"></span>
        </div>

        <div class="footer">ทิป: ถ้ามีเบอร์โทรมากกว่า 1 เบอร์ ระบบจะพยายามเลือก “เบอร์ที่เหมือนเบอร์หลัก” ที่สุด (ตัวเลข 10 หลัก) แล้ววางให้อยู่ช่วงบรรทัดที่ 2–3 โดยไม่ให้เป็นบรรทัดแรก/สุดท้าย</div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between; margin-bottom:10px">
          <span class="pill">ตัวเลือกการแปลง</span>
          <span class="pill">สุ่มมากขึ้น = หลากหลายขึ้น</span>
        </div>

        <div class="ctl" style="margin-bottom:10px">
          <input id="optSpaces" type="checkbox" checked />
          <div>
            <label for="optSpaces">สุ่มเว้นวรรคเล็กน้อย</label>
            <small>เพิ่ม/ลดช่องว่างแบบ “พอดี” เพื่อให้ไม่ซ้ำแพทเทิร์นเดิม</small>
          </div>
        </div>

        <div class="ctl" style="margin-bottom:10px">
          <input id="optPunct" type="checkbox" checked />
          <div>
            <label for="optPunct">แทรกอักขระแบบพอดี</label>
            <small>ใช้ . , ~ - ํ ๐ แบบไม่ถี่เกินไป (ยังอ่านง่ายในครั้งเดียว)</small>
          </div>
        </div>

        <div class="ctl" style="margin-bottom:10px">
          <input id="optReorder" type="checkbox" checked />
          <div>
            <label for="optReorder">สลับลำดับบางบรรทัด</label>
            <small>สลับเฉพาะบรรทัดกลาง ๆ และรักษาความหมายเดิม</small>
          </div>
        </div>

        <div class="ctl" style="margin-bottom:10px">
          <div style="flex:1">
            <label for="lineMode">รูปแบบบรรทัด</label>
            <small>เลือกให้อยู่บรรทัดเดียวหรือคงหลายบรรทัด</small>
          </div>
          <select id="lineMode">
            <option value="multi" selected>หลายบรรทัด</option>
            <option value="single">บรรทัดเดียว</option>
          </select>
        </div>

        <div class="ctl" style="margin-bottom:10px">
          <div style="flex:1">
            <label for="variants">จำนวนผลลัพธ์</label>
            <small>แสดง 4–5 แบบ พร้อมปุ่มคัดลอกแยก</small>
          </div>
          <select id="variants">
            <option value="4">4 แบบ</option>
            <option value="5" selected>5 แบบ</option>
          </select>
        </div>

        <div class="ctl">
          <div style="flex:1">
            <label for="strength">ระดับความหลากหลาย</label>
            <small>คุม “พอดี” ไม่ให้รกจนอ่านยาก</small>
          </div>
          <select id="strength">
            <option value="1">น้อย</option>
            <option value="2" selected>กลาง</option>
            <option value="3">มาก</option>
          </select>
        </div>

        <p class="note">หมายเหตุ: เครื่องมือนี้เป็นตัวช่วย “จัดรูปแบบให้ไม่ซ้ำและอ่านง่าย” ไม่ได้การันตีผลกับระบบภายนอกใด ๆ</p>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="row" style="justify-content:space-between; margin-bottom:10px">
        <span class="pill">ผลลัพธ์</span>
        <button id="btnCopyAll">คัดลอกทุกแบบ (ต่อกันด้วยเส้นคั่น)</button>
      </div>
      <div id="outputs" class="outGrid"></div>
    </div>

  </div>

  <script>
    // -----------------------------
    // Utility: seeded RNG (mulberry32)
    // -----------------------------
    function mulberry32(seed){
      let t = seed >>> 0;
      return function(){
        t += 0x6D2B79F5;
        let r = Math.imul(t ^ (t >>> 15), 1 | t);
        r ^= r + Math.imul(r ^ (r >>> 7), 61 | r);
        return ((r ^ (r >>> 14)) >>> 0) / 4294967296;
      };
    }

    function randInt(rng, min, max){
      return Math.floor(rng() * (max - min + 1)) + min;
    }

    function pick(rng, arr){
      return arr[Math.floor(rng() * arr.length)];
    }

    function shuffle(rng, arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(rng()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    // -----------------------------
    // Phone extraction (Thai-like)
    // - Keep digits intact
    // - Accept optional separators
    // -----------------------------
    function findPhones(text){
      // Capture likely Thai phone numbers: 10 digits, may include spaces/hyphens
      // Example: 0658069021, 089-7893436, 06 580 690 21 (we'll normalize)
      const re = /(?<!\d)(0\d[\d\s-]{7,15}\d)(?!\d)/g;
      const matches = [];
      let m;
      while((m = re.exec(text))){
        const raw = m[1];
        const digits = raw.replace(/\D/g,'');
        if(digits.length === 10){
          matches.push({ raw, digits, index: m.index });
        }
      }
      // de-dup by digits
      const seen = new Set();
      return matches.filter(x => (seen.has(x.digits) ? false : (seen.add(x.digits), true)));
    }

    // Format phone for readability (keep digits correct)
    function formatPhone(rng, digits){
      // Thai mobile typically 3-3-4. We'll optionally add hyphen/space lightly.
      const a = digits.slice(0,3);
      const b = digits.slice(3,6);
      const c = digits.slice(6);
      const style = pick(rng, ['plain','dash','space','dash2']);
      if(style==='plain') return digits;
      if(style==='dash') return `${a}-${b}-${c}`;
      if(style==='space') return `${a} ${b} ${c}`;
      return `${a}-${b} ${c}`; // dash2
    }

    // -----------------------------
    // Light spacing/punctuation injection (bounded)
    // Keep it readable; never touch digit sequences
    // -----------------------------
    const PUNCTS = ['.', ',', '~', '-', 'ํ', '๐'];

    function lightInject(rng, s, strength){
      // Strength controls how many injections per line (bounded)
      const maxPerLine = strength === 1 ? 1 : strength === 2 ? 2 : 3;

      // Avoid injecting inside numbers; split into tokens keeping spaces
      const parts = s.split(/(\s+)/);
      let injectCount = 0;

      for(let i=0;i<parts.length;i++){
        const token = parts[i];
        // Skip whitespace tokens
        if(/^\s+$/.test(token)) continue;
        // Skip pure numbers
        if(/^\d+$/.test(token)) continue;
        // Skip tokens that contain long digit runs (phone/postcode)
        if(/\d{4,}/.test(token)) continue;

        // Maybe add punctuation at end of some tokens
        if(injectCount < maxPerLine && rng() < (strength===1?0.12: strength===2?0.18:0.22)){
          const p = pick(rng, PUNCTS);
          // Only add if not already ending with punct
          if(!/[\.,~\-๐ํ]$/.test(parts[i])){
            parts[i] = parts[i] + p;
            injectCount++;
          }
        }
      }

      return parts.join('');
    }

    function lightSpaces(rng, s, strength){
      // Add/remove tiny spaces around punctuation or between Thai chunks lightly.
      // Keep it readable: do not collapse newlines here.
      const maxTweaks = strength === 1 ? 2 : strength === 2 ? 4 : 6;
      let out = s;

      // Small set of safe tweaks; each tweak is applied at most a few times.
      const tweaks = [
        // add a space after comma/dot if missing
        (x) => x.replace(/([\.,])(?=\S)/g, '$1 '),
        // occasionally double a single space (readable)
        (x) => x.replace(/(?<=\S) (?! )/g, (m) => (rng() < 0.12 ? '  ' : ' ')),
        // occasionally remove one of double spaces
        (x) => x.replace(/ {2,}/g, (m) => (rng() < 0.18 ? ' ' : m)),
        // add a tiny separator around hyphen sometimes
        (x) => x.replace(/(?<=\S)-(?=\S)/g, (m) => (rng() < 0.18 ? ' - ' : '-')),
      ];

      const order = shuffle(rng, tweaks);
      let applied = 0;
      for(const fn of order){
        if(applied >= maxTweaks) break;
        const before = out;
        out = fn(out);
        if(out !== before) applied++;
      }
      return out;
    }

    // -----------------------------
    // Reorder lines (middle only)
    // -----------------------------
    function reorderLines(rng, lines, strength){
      if(lines.length < 3) return lines;

      // protect first and last line
      const first = lines[0];
      const last = lines[lines.length-1];
      const mid = lines.slice(1, -1);

      // strength controls how much we shuffle; keep it mild
      const swaps = strength === 1 ? 1 : strength === 2 ? 2 : 3;
      let arr = mid.slice();

      for(let k=0;k<swaps;k++){
        if(arr.length < 2) break;
        const i = randInt(rng, 0, arr.length-1);
        let j = randInt(rng, 0, arr.length-1);
        if(i === j) j = (j+1) % arr.length;
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }

      return [first, ...arr, last];
    }

    // -----------------------------
    // Ensure phone line positioned around line 2 or 3 (not first/last)
    // -----------------------------
    function placePhoneMid(lines, phoneDigits, rng){
      if(!phoneDigits) return lines;

      // Remove any existing line that contains the phone digits (normalized)
      const normDigits = phoneDigits;
      const cleaned = [];
      for(const ln of lines){
        const d = ln.replace(/\D/g,'');
        if(d.includes(normDigits)) continue;
        cleaned.push(ln);
      }

      if(cleaned.length === 0){
        // If input was only phone, create minimal scaffold
        cleaned.push('');
        cleaned.push('');
      }

      // Choose target index: 1 or 2 (line 2 or 3), but must not be last
      const targetChoices = [1,2].filter(i => i < Math.max(2, cleaned.length));
      let target = targetChoices.length ? pick(rng, targetChoices) : 1;
      // Clamp: not first, not last
      if(target <= 0) target = 1;
      if(target >= cleaned.length) target = Math.max(1, cleaned.length-1);

      const phoneStr = formatPhone(rng, normDigits);

      // Insert phone line
      const out = cleaned.slice();
      out.splice(target, 0, phoneStr);

      // Ensure not first/last
      if(out.length >= 2){
        if(out[0].replace(/\D/g,'') === normDigits){
          out.push(out.shift());
        }
        if(out[out.length-1].replace(/\D/g,'') === normDigits){
          out.splice(1, 0, out.pop());
        }
      }

      // Trim extra empty lines at ends
      while(out.length && out[0].trim()==='') out.shift();
      while(out.length && out[out.length-1].trim()==='') out.pop();

      // Final check: phone not first/last
      if(out.length >= 3){
        const firstD = out[0].replace(/\D/g,'');
        const lastD = out[out.length-1].replace(/\D/g,'');
        if(firstD === normDigits){
          const moved = out.shift();
          out.splice(1, 0, moved);
        }
        if(lastD === normDigits){
          const moved = out.pop();
          out.splice(1, 0, moved);
        }
      }

      return out;
    }

    // -----------------------------
    // Main transform
    // -----------------------------
    function transform(text, opts, seed){
      const rng = mulberry32(seed);

      // Normalize newlines, keep content
      const rawLines = text.replace(/\r\n/g,'\n').replace(/\r/g,'\n').split('\n');
      let lines = rawLines.map(l => l.trim()).filter(l => l.length > 0);

      // Pick a primary phone number if any
      const phones = findPhones(text);
      const phoneDigits = phones.length ? phones[0].digits : null;

      // Place phone around line 2–3
      lines = placePhoneMid(lines, phoneDigits, rng);

      // Reorder middle lines (optional)
      if(opts.reorder){
        lines = reorderLines(rng, lines, opts.strength);
        // Re-ensure phone in mid after reorder
        lines = placePhoneMid(lines, phoneDigits, rng);
      }

      // Apply per-line transformations
      const outLines = lines.map((ln, idx) => {
        let s = ln;

        // Never modify the digits of phone; if this line is the phone line, keep digits and only add mild separators (already formatted)
        const isPhoneLine = phoneDigits && (s.replace(/\D/g,'') === phoneDigits);

        if(!isPhoneLine){
          if(opts.punct) s = lightInject(rng, s, opts.strength);
          if(opts.spaces) s = lightSpaces(rng, s, opts.strength);
        } else {
          // still allow extremely mild spacing around hyphen if present
          if(opts.spaces) s = s.replace(/(?<=\d)-(?=\d)/g, (m) => (rng() < 0.18 ? '-': '-'));
        }

        // Occasional harmless suffix/prefix marker on non-phone lines (bounded)
        if(!isPhoneLine && opts.punct && rng() < (opts.strength===1?0.05: opts.strength===2?0.08:0.10)){
          const p = pick(rng, ['.', ' ~', ' -', '']);
          s = s + p;
        }

        return s.trim();
      });

      let out = '';
      if(opts.lineMode === 'single'){
        // Join lines with a readable separator that varies (bounded)
        const sep = pick(rng, [' | ', ' • ', ' / ', '  ']);
        out = outLines.join(sep);
      } else {
        out = outLines.join('\n');
      }

      return { out, phoneDigits };
    }

    // -----------------------------
    // UI wiring
    // -----------------------------
    const elInput = document.getElementById('input');
    const elOutputs = document.getElementById('outputs');
    const elGenStatus = document.getElementById('genStatus');
    const elPhoneStatus = document.getElementById('phoneStatus');

    function updatePhoneStatus(){
      const phones = findPhones(elInput.value || '');
      if(phones.length){
        elPhoneStatus.innerHTML = `<span class="ok">พบเบอร์โทร ${phones[0].digits}</span>`;
      } else {
        elPhoneStatus.innerHTML = `<span class="warn">ไม่พบบรรทัดที่เหมือนเบอร์โทร 10 หลัก</span>`;
      }
    }

    elInput.addEventListener('input', updatePhoneStatus);
    updatePhoneStatus();

    function getOpts(){
      return {
        spaces: document.getElementById('optSpaces').checked,
        punct: document.getElementById('optPunct').checked,
        reorder: document.getElementById('optReorder').checked,
        lineMode: document.getElementById('lineMode').value,
        variants: parseInt(document.getElementById('variants').value, 10),
        strength: parseInt(document.getElementById('strength').value, 10),
      };
    }

    async function copyText(txt){
      try{
        await navigator.clipboard.writeText(txt);
        return true;
      } catch {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        return ok;
      }
    }

    function renderOutputs(items){
      elOutputs.innerHTML = '';
      items.forEach((it, idx) => {
        const card = document.createElement('div');
        card.className = 'outCard';

        const head = document.createElement('div');
        head.className = 'outHead';

        const title = document.createElement('b');
        title.textContent = `แบบที่ ${idx+1}`;

        const actions = document.createElement('div');
        actions.className = 'actions';

        const btnCopy = document.createElement('button');
        btnCopy.textContent = 'คัดลอก';
        btnCopy.addEventListener('click', async () => {
          const ok = await copyText(it.out);
          btnCopy.textContent = ok ? 'คัดลอกแล้ว ✓' : 'คัดลอกไม่สำเร็จ';
          setTimeout(()=> btnCopy.textContent='คัดลอก', 900);
        });

        const btnSelect = document.createElement('button');
        btnSelect.textContent = 'ใช้แบบนี้';
        btnSelect.addEventListener('click', () => {
          // Put selected output back to input for quick tweaks
          elInput.value = it.out;
          updatePhoneStatus();
          window.scrollTo({top:0, behavior:'smooth'});
        });

        actions.appendChild(btnCopy);
        actions.appendChild(btnSelect);
        head.appendChild(title);
        head.appendChild(actions);

        const pre = document.createElement('div');
        pre.className = 'out';
        pre.textContent = it.out;

        card.appendChild(head);
        card.appendChild(pre);
        elOutputs.appendChild(card);
      });
    }

    function generate(){
      const text = elInput.value || '';
      const trimmed = text.trim();
      if(!trimmed){
        elGenStatus.textContent = 'กรุณาวางข้อความก่อน';
        renderOutputs([]);
        return;
      }

      const opts = getOpts();
      // Use time + randomness to produce high variety. Each output uses distinct seed.
      const baseSeed = (Date.now() ^ (Math.random()*1e9)) >>> 0;

      const items = [];
      const seen = new Set();

      // Try a bit more than needed to reduce near-duplicates
      const target = Math.min(Math.max(opts.variants, 4), 5);
      const maxAttempts = 40;
      let attempts = 0;

      while(items.length < target && attempts < maxAttempts){
        const seed = (baseSeed + attempts*2654435761) >>> 0;
        const res = transform(trimmed, opts, seed);
        const key = res.out;
        if(!seen.has(key)){
          seen.add(key);
          items.push(res);
        }
        attempts++;
      }

      renderOutputs(items);
      elGenStatus.textContent = `สร้างแล้ว ${items.length} แบบ`;
      setTimeout(()=> elGenStatus.textContent = '', 1200);
    }

    document.getElementById('btnGen').addEventListener('click', generate);

    document.getElementById('btnClear').addEventListener('click', () => {
      elInput.value = '';
      renderOutputs([]);
      updatePhoneStatus();
    });

    document.getElementById('btnCopyAll').addEventListener('click', async () => {
      const outs = Array.from(elOutputs.querySelectorAll('.out')).map(x => x.textContent);
      if(!outs.length) return;
      const joined = outs.join('\n\n-----\n\n');
      const ok = await copyText(joined);
      const btn = document.getElementById('btnCopyAll');
      btn.textContent = ok ? 'คัดลอกทุกแบบแล้ว ✓' : 'คัดลอกไม่สำเร็จ';
      setTimeout(()=> btn.textContent='คัดลอกทุกแบบ (ต่อกันด้วยเส้นคั่น)', 900);
    });

    // Generate once on load (if user already pasted something)
    // (kept off by default to avoid surprising behavior)
  </script>
</body>
</html>
